---
title: 01.加密和哈希的区别
date: 2021-02-27 21:35:35
permalink: /pages/01.加密和哈希
author: kcy
---

# 哈希（Hash）与加密（Encrypt）的区别

## 概述
* 哈希（Hash）是将目标文本转换成具有相同长度的、不可逆的杂凑字符串（或叫做消息摘要），而加密（Encrypt）是将目标文本转换成具有不同长度的、可逆的密文。
## 区别
* 哈希算法往往被设计成生成具有相同长度的文本，而加密算法生成的文本长度与明文本身的长度有关
  + 例如，设我们有两段文本：“Microsoft”和“Google”。两者使用某种哈希算法得到的结果分别为：“140864078AECA1C7C35B4BEB33C53C34”和“8B36E9207C24C76E6719268E49201D94”，而使用某种加密算法的到的结果分别为“Njdsptpgu”和“Hpphmf”。可以看到，哈希的结果具有相同的长度，而加密的结果则长度不同。
  + 如果使用相同的哈希算法，不论你的输入有多么长，得到的结果长度是一个常数，例如MD5算法输出32位十六进制（128位二进制）长度字符串；而加密算法往往与明文的长度成正比
* 哈希算法是不可逆的，而加密算法是可逆的
  + 数学理解：哈希是一个多对一映射，哈希算法的定义域是一个无限集合，而值域是一个有限集合，将无限集合映射到有限集合，根据“鸽笼原理”（现在有十只鸽子但只有九个笼子，那么必定有一个笼子里至少有两只鸽子），每个哈希结果都存在无数个可能的目标文本，因此哈希不是一一映射，是不可逆的
  + 而加密算法是一一映射，因此理论上来说是可逆的

# 常用的哈希算法（哈希函数）
## MD5
*  消息摘要演算法（Message-Digest Algorithm），一种被广泛使用的密码杂凑函数，将任意长度的明文字符串生成一个128位的哈希值（hash value），前端打印出来长度为32的十六进制数
* 应用：安全访问认证（账密登录，前端传输md5(password)，防止直接看到明文，后端保存MD5值，即使数据库信息泄露也不能直接获取明文），这不但可以避免用户的密码被具有系统管理员权限的用户知道，而且还在一定程度上增加了密码被破解的难度
![应用](https://images.cnblogs.com/cnblogs_com/leoo2sk/WindowsLiveWriter/HashEncrypt_11FA9/2_3.png)
## sha系列
* SHA-1 ： 产生一个160位的哈希值，比起MD5 产生位数多了，抗穷举性更好
* SHA256 ： 产生一个256位的哈希值，用长度为64的十六进制字符串来表示
* 应用：公司内部系统里JWT token鉴权中的Signature使用了SHA256算法产生，放在 HTTP 请求的头信息Authorization字段里面进行前后端鉴权





## 优缺点
### 优点
+ 稳定、运算速度快。
+ 压缩性：输入任意长度的数据，输出长度固定。
+ 运算不可逆：已知运算结果的情况下，无法通过通过逆运算得到原始字符串。
+ 高度离散：输入的微小变化，可导致运算结果差异巨大
### 缺点
* 哈希碰撞：不同的输入却产生了相同的输出
* 暴力穷举法破解：通俗来说，就是在一个范围内，如从000000到999999，将其中所有值一个一个用相同的哈希算法哈希，然后将结果和杂凑串比较，如果相同，则这个值就一定是源字串或源字串的一个碰撞，于是就可以用这个值非法登录了
* 彩虹表：我们可以将彩虹表理解成一张用于加密散列函数逆运算的预先计算好的大表，其中存储着一些常见密码的哈希（这就是为什么不要使用常用密码，以及不要使用生日作为密码的原因），当攻击者通过入侵拿到某些网站的数据库之后就可以通过预计算表中存储的映射来查找原始密码。这是以空间换时间的典型实践，在每一次尝试都计算的暴力破解中使用更少的计算能力和更多的储存空间，但却比简单的每个输入一条散列的翻查表使用更少的储存空间和更多的计算性能。
### 解决方案
* 密码加盐：在密码学中，是指在散列之前将散列内容（例如：密码）的任意固定位置插入特定的字符串，在大部分情况，盐是不需要保密的。盐可以是随机产生的字符串，其插入的位置可以也是随意而定
```javascript
  const crypto = require("crypto");

  function cryptPwd(password, salt) {
    const saltPassword = password + ":" + salt;
    console.log("原始密码：", password);
    console.log("加盐后的密码：", saltPassword);

    const md5 = crypto.createHash("md5");
    const result = md5.update(saltPassword).digest("hex");
    console.log("加盐密码的md5值：", result);
  }

  cryptPwd("123456789","exe");

  // 原始密码：123456789
  // 加盐后的密码：123456789:exe
  // 加盐密码的md5值：3328003d9f786897e0749f349af490ca
```
* 多重混合哈希：使用不同的哈希函数配合自定义的salt对口令进行多次哈希，如果salt很复杂，那么穷举法将变得异常艰难，例如SHA1（MD5（password）MD5(salt)）

## 应用
* 消息摘要算法是密码学算法中非常重要的一个分支，它通过对所有数据提取指纹信息以实现数据签名、数据完整性校验等功能，由于其不可逆性，有时候会被用做敏感信息的加密。
* 浏览器的协商缓存的Etag，存储的是文件的特殊标识(一般都是 hash 生成的)
* 一致性检验：有很多时候,你会发现网络上的很多文件的命名都是一段hash值加后缀名的方式.这样处理的好处是能在一定的程度上避免同名,更大的用处是能够根据其文件内容来获取专属的MD5值来命名

# 常用的加密算法
## 概述
* 加密算法分 对称加密 和 非对称加密，其中对称加密算法的加密与解密 密钥相同，常见算法：DES、3DES、AES；非对称加密算法的加密密钥与解密 密钥不同，常见算法：RSA、DSA
## 对称加密
* 对称加密算法 是应用较早的加密算法，又称为 共享密钥加密算法。在 对称加密算法 中，使用的密钥只有一个，发送 和 接收 双方都使用这个密钥对数据进行 加密 和 解密。这就要求加密和解密方事先都必须知道加密的密钥。
  +  数据加密过程：在对称加密算法中，数据发送方 将 明文 (原始数据) 和 加密密钥 一起经过特殊 加密处理，生成复杂的 加密密文 进行发送
  + 数据解密过程：数据接收方 收到密文后，若想读取原数据，则需要使用 加密使用的密钥 及相同算法的 逆算法 对加密的密文进行解密，才能使其恢复成 可读明文
![交互流程](https://user-gold-cdn.xitu.io/2018/7/13/16493f2bfa02dbcd?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### DES算法
* 是分组加密算法的典型代表，同时也是应用最为广泛的对称加密算法，以64 位为分组对数据加密，密钥长度是56位，加密解密用同一算法，速度较快，适用于加密大量数据的场合


### 3DES算法
* 是基于DES的三重数据加密算法，相当于是对每个数据库应用三次DES的对称加密算法对一块数据用三个不同的密钥进行三次加密，强度更高，密钥长度是168位，运算速度慢，3DES算法是对DES算法的改进，增加DES的密钥长度来避免由于DES密码长度容易被暴力破解的类似攻击

### AES算法
* 高级加密标准(AES,Advanced Encryption Standard)为最常见的对称加密算法，相比DES，3DES因密钥长度变长，安全性有所提高，但其处理速度不高。因此又出现了AES加密算法，AES较于3DES速度更快、安全性更高（微信小程序加密传输就是用这个加密算法的)

### 优缺点
* 对称加密算法的优点是算法公开、计算量小、加密速度快、加密效率高。

* 对称加密算法的缺点是在数据传送前，发送方和接收方必须商定好秘钥，然后使双方都能保存好秘钥。其次如果一方的秘钥被泄露，那么加密信息也就不安全了。另外，每一对用户每次使用对称加密算法时，都需要使用其他人不知道的唯一秘钥，这会使得收、发双方所拥有的钥匙数量巨大，密钥管理成为双方的负担。

### 应用
* 保存用户手机号、身份证等敏感但能解密的信息


## 非对称加密
* 非对称加密算法，又称为 公开密钥加密算法。与对称加密算法不同，非对称加密算法需要两个密钥：公开密钥（publickey）和私有密钥（privatekey）。公开密钥与私有密钥是一对，如果用公开密钥对数据进行加密，只有用对应的私有密钥才能解密；如果用私有密钥对数据进行加密，那么只有用对应的公开密钥才能解密。因为加密和解密使用的是两个不同的密钥，所以这种算法叫作非对称加密算法。
  + 如果使用 公钥 对数据 进行加密，只有用对应的 私钥 才能 进行解密。如果使用 私钥 对数据 进行加密，只有用对应的 公钥 才能 进行解密。
  + 例子：甲方生成 一对密钥 并将其中的一把作为 公钥 向其它人公开，得到该公钥的 乙方 使用该密钥对机密信息 进行加密 后再发送给甲方，甲方再使用自己保存的另一把 专用密钥 (私钥)，对 加密 后的信息 进行解密。
![交互流程](https://user-gold-cdn.xitu.io/2018/7/13/16493f2bfa06e955?imageslim)

### RSA算法
* RSA 加密算法是目前最有影响力的 公钥加密算法，并且被普遍认为是目前 最优秀的公钥方案 之一。RSA 是第一个能同时用于 加密 和 数字签名 的算法，它能够 抵抗 到目前为止已知的 所有密码攻击，已被 ISO 推荐为公钥数据加密标准，是一个支持变长密钥的公共密钥算法，需要加密的文件块的长度也是可变的

### ECC 算法
* ECC 也是一种 非对称加密算法，主要优势是在某些情况下，它比其他的方法使用 更小的密钥，比如 RSA 加密算法，提供 相当的或更高等级 的安全级别。不过一个缺点是 加密和解密操作 的实现比其他机制 时间长 (相比 RSA 算法，该算法对 CPU 消耗严重)

### 优缺点
* 非对称加密算法的优点是安全性更高，公钥是公开的，秘钥是自己保存的，不需要将私钥给别人
* 非对称加密算法的缺点是加密和解密花费时间长、速度慢，只适合对少量数据进行加密

## 对称算法与非对称加密算法比较
* 对称算法：
  + 密钥管理：比较难，不适合互联网，一般用于内部系统
  + 安全性：中
  + 加密速度：快好 几个数量级 (软件加解密速度至少快 100 倍，每秒可以加解密数 M 比特 数据)，适合大数据量的加解密处理
* 非对称算法
  + 密钥管理：密钥容易管理
  + 安全性：高
  + 加密速度：比较慢，适合 小数据量 加解密或数据签名


